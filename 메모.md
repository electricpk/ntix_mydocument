
### InGameGroup Entity 관리

## 기존 코드 이해

EntityMgr
{
    m_dicEntitys - EntityID로 찾는 Entity
    m_dicTeamEntitys - 팀별로 묶인 Entity
    m_dicEnemyEntitys - 다른 팀이 아닌데도 적이 될 수 있었나?
}

## 할 일
[v] 구 AI코드 전부 제거


* 로직 확인
    // GC 최적화를 위한 캐싱 리스트
    private static readonly List<Entity> s_emptyEntityList = new List<Entity>();
    private List<Entity> m_cachedEnemyList = new List<Entity>(100);
    
- InGameGroup 2차 코드 정리 계획 - Antigravity - hkpark/EntityMgr_코드정리_계획.md





# 멀티플레이, PvP 버그 수정 및 개선
[v] 간헐적으로 다른 캐릭터가 안보이는 문제
    - 네트워크 가시성 문제로 추정
    - Die -> Respawn 흐름에서 GameObject를 on/off 하지만 가시성쪽에서는 renderer만 관리
    => Die -> Respawn 흐름에서 GameObject 대신 renderer를 on/off 처리하도록 수정해여 문제 해결

[v] cc로 액션이 끊기는 경우 조작 안되는 문제
    - 에어본 버프가 풀리지 않는 문제
    - 닥터카오스만 에어본 애니메이션이 없어서 발생하는 문제였음
    => 애니메이션 추가로 해결


[*] 가시성 변화에 따른 hp바 비정상 표시 문제 - 실패중!
    - 호스트+AI캐릭터 싱글플레이: 멀리서 부활시 hp바 안보임
    *** 디버깅 기록 문서 확인하기 ***




# 에어본 리뉴얼



모든 Entity(캐릭터+몬스터)들은 리액션이라고 해서 일종의 상태이상들이 있어.
현재 리액션 종류는 경직, 넉다운, 에어본, 넉백 이렇게 4가지가 있어.
지금 현재는 주로 Entity+Server.cs에 로직들이 있지.

잘 동작하고 있었는데 이번에 에어본이 살짝 리뉴얼이 필요해졌어.
그냥 아트팀, 기획팀과 상의하고 아주 약간의 변경사항이 생긴건데
이 참에 더 좋은 구조로 리펙토링을 하는게 어떨까하는 고민이 있어.

만약 리펙토링을 한다면..
나는 코드를 '분리'하는걸 좋아해.
Entity안에 여러가지 리액션 로직이 들어있다보니 코드도 너무 길어지고 함수 하나로 끝내지도 못하고
각 리액션마다 관련된 멤버변수들도 생기다보니 복잡해.

일단 나의 생각은..
새롭게 리액션 관리 클래스를 만든다. (EntityReactionManager)
내가 주로 선호하는 방식은 상속없는 일반 클래스로 만들어서 Entity 멤버변수로 선언하고 new(this) 해서 사용하는 거야.
리액션메니저안에 또 각각의 리액션 클래스를 또 만들수도 있겠지.

그러면서 추가로 중요한 점은

- 시작하고 끝나고 그런 상태관리를 확실하게 해야됨.
- Mirror 네트워크 기반의 커스텀 클라예측 시스템으로 되어 있는데 서버와 클라의 동기화를 신경써야됨.



